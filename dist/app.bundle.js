"use strict";(self.webpackChunkcryptic_crossword=self.webpackChunkcryptic_crossword||[]).push([[143],{985:()=>{var t;!function(t){t[t.Horizontal=1]="Horizontal",t[t.Vertical=2]="Vertical"}(t||(t={}));class e{constructor(t,e,i){this.LOCAL_STORAGE_VCN_KEY="VCN",this.LOCAL_STORAGE_VCN_VAL="1",this.LOCAL_STORAGE_KEY_PREFIX="crossword_",this.crossword_id=t,this.rows=e,this.cols=i,this.local_storage_key=this.LOCAL_STORAGE_KEY_PREFIX+t.toString(),this.localStorageInit(),this.user_input=this.loadInput()}localStorageInit(){localStorage.getItem(this.LOCAL_STORAGE_VCN_KEY)!=this.LOCAL_STORAGE_VCN_VAL&&localStorage.clear(),localStorage.setItem(this.LOCAL_STORAGE_VCN_KEY,this.LOCAL_STORAGE_VCN_VAL)}loadInput(){const t=localStorage.getItem(this.local_storage_key);try{if(null==t||""==t)throw new Error("No previous input");const e=JSON.parse(t);if(e.length!=this.rows||e[0].length!=this.cols)throw new Error("Invalid input");return e}catch(t){return Array.from({length:this.rows},(()=>Array.from({length:this.cols},(()=>""))))}}getLetter(t){if(t.row<0||t.row>=this.rows||t.col<0||t.col>=this.cols)throw new Error("Invalid input for getLetter!");return this.user_input[t.row][t.col]}setLetter(t,e){if(t.row<0||t.row>=this.rows||t.col<0||t.col>=this.cols||e.length>1)throw new Error("Invalid input for setLetter!");this.user_input[t.row][t.col]=e,localStorage.setItem(this.local_storage_key,JSON.stringify(this.user_input))}}class i{constructor(){this.clickContext={activeCoordinate:null,previousCoordinate:null,direction:t.Horizontal},this.storageContext=null,this.crossword=document.getElementById("crossword"),this.clues_horizontal=document.getElementById("clues_horizontal"),this.clues_vertical=document.getElementById("clues_vertical"),this.addKeyListener()}showCrossword(t){var i;document.getElementById("title").textContent=`תשבץ אינטל ${t.id}`,document.getElementById("author").textContent=`${t.author}`,this.crossword.innerHTML="",this.clues_horizontal.innerHTML="<h3>מאוזן</h3>",this.clues_vertical.innerHTML="<h3>מאונך</h3>",this.storageContext=new e(t.id,t.dimensions.rows,t.dimensions.columns),this.crossword.appendChild(this.createPuzzleSvg(t)),this.clues_horizontal.appendChild(this.createClues("across",t)),this.clues_vertical.appendChild(this.createClues("down",t)),document.getElementById("wrapper").classList.remove("hide"),null===(i=document.getElementById("loader"))||void 0===i||i.remove()}createClues(t,e){const i=document.createElement("dl");for(const o in e.definitions[t]){const n=document.createElement("dt");n.textContent=`[${o}]`;const r=document.createElement("dd");r.textContent=`${e.definitions[t][o]}`,i.appendChild(n),i.appendChild(r)}return i}createPuzzleSvg(t){const e=40,i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("width",""+e*t.dimensions.columns),i.setAttribute("height",""+e*t.dimensions.rows),this.grid=new Array(t.dimensions.rows);for(let o=0;o<t.dimensions.rows;++o){this.grid[o]=[];for(let n=0;n<t.dimensions.columns;++n){let r=null;const s=document.createElementNS("http://www.w3.org/2000/svg","g"),l=document.createElementNS("http://www.w3.org/2000/svg","rect");if(l.setAttribute("x",""+e*n),l.setAttribute("y",""+e*o),l.setAttribute("width","40"),l.setAttribute("height","40"),l.setAttribute("stroke","black"),l.setAttribute("stroke-width","1"),l.setAttribute("fill","white"),s.appendChild(l),"#"==t.grid[o][n])l.setAttribute("fill","black");else{if(""!=t.grid[o][n]){const i=document.createElementNS("http://www.w3.org/2000/svg","text");i.setAttribute("x",""+(n*e+e-4)),i.setAttribute("y",""+(o*e+12)),i.setAttribute("style","fill: black; font-size: 10px;"),i.textContent=t.grid[o][n],s.appendChild(i)}const i=document.createElementNS("http://www.w3.org/2000/svg","text");i.setAttribute("x",""+(n*e+20)),i.setAttribute("y",""+(o*e+30)),i.setAttribute("text-anchor","middle"),i.setAttribute("style","fill: black; font-size: 30px;"),s.appendChild(i),r={rect:l,text:i},i.addEventListener("click",(function(){c.handleRectClick(o,n)})),i.textContent=this.storageContext.getLetter({row:o,col:n})}i.appendChild(s),this.grid[o][n]=r;const c=this;l.addEventListener("click",(function(){c.handleRectClick(o,n)}))}}return i}swapDirection(){this.clickContext.direction=this.clickContext.direction==t.Horizontal?t.Vertical:t.Horizontal}isCoordFree(t){return!(t.row<0||t.row>=this.grid.length||t.col<0||t.col>=this.grid[0].length)&&null!=this.grid[t.row][t.col]}nextCoordinate(e){const i={row:e.row,col:e.col};return this.clickContext.direction==t.Horizontal?i.col-=1:i.row+=1,this.isCoordFree(i)?i:null}prevCoordinate(e){const i={row:e.row,col:e.col};return this.clickContext.direction==t.Horizontal?i.col+=1:i.row-=1,this.isCoordFree(i)?i:null}highlightDefinition(t){let e=null,i=null;if(document.querySelectorAll("rect.highlighted").forEach((t=>{t.classList.remove("highlighted"),t.setAttribute("fill","white")})),null!=t){null==this.prevCoordinate(t)&&null==this.nextCoordinate(t)&&this.swapDirection();for(const o of[this.prevCoordinate,this.nextCoordinate]){e={row:t.row,col:t.col};do{i=this.grid[e.row][e.col],null==i||i.rect.setAttribute("fill","#ccffff"),null==i||i.rect.setAttribute("class","highlighted"),e=o.call(this,e)}while(null!=e)}i=this.grid[t.row][t.col],null==i||i.rect.setAttribute("fill","#ffffcc"),null==i||i.rect.setAttribute("class","highlighted")}}handleRectClick(t,e){null!=this.grid[t][e]&&(this.clickContext.previousCoordinate=this.clickContext.activeCoordinate,this.clickContext.activeCoordinate={row:t,col:e},JSON.stringify(this.clickContext.previousCoordinate)==JSON.stringify(this.clickContext.activeCoordinate)&&this.swapDirection(),this.highlightDefinition({row:t,col:e}))}addKeyListener(){document.addEventListener("keydown",(t=>{var e,i,o;if(null==this.clickContext.activeCoordinate)return;const n=this.grid[this.clickContext.activeCoordinate.row][this.clickContext.activeCoordinate.col];null!=n&&(1===t.key.length&&/^[a-zA-Z\u0590-\u05FF]$/.test(t.key)?(n.text.textContent=t.key,null===(e=this.storageContext)||void 0===e||e.setLetter(this.clickContext.activeCoordinate,n.text.textContent),this.clickContext.activeCoordinate=this.nextCoordinate(this.clickContext.activeCoordinate),this.highlightDefinition(this.clickContext.activeCoordinate)):"Backspace"===t.key?(n.text.textContent="",null===(i=this.storageContext)||void 0===i||i.setLetter(this.clickContext.activeCoordinate,n.text.textContent),this.clickContext.activeCoordinate=this.prevCoordinate(this.clickContext.activeCoordinate),this.highlightDefinition(this.clickContext.activeCoordinate)):"Delete"==t.key&&(n.text.textContent="",null===(o=this.storageContext)||void 0===o||o.setLetter(this.clickContext.activeCoordinate,n.text.textContent)))}))}showIndex(t){var e;const i=document.getElementById("crossword_list");for(let e of t.ids){let t=document.createElement("li"),o=document.createElement("a");o.textContent=`תשבץ ${e}`,o.setAttribute("href",`?id=${e}`),t.appendChild(o),i.appendChild(t)}document.getElementById("index").classList.remove("hide"),null===(e=document.getElementById("loader"))||void 0===e||e.remove()}}var o=function(t,e,i,o){return new(i||(i=Promise))((function(n,r){function s(t){try{c(o.next(t))}catch(t){r(t)}}function l(t){try{c(o.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,l)}c((o=o.apply(t,e||[])).next())}))};document.addEventListener("DOMContentLoaded",(function(){return o(this,void 0,void 0,(function*(){yield function(){return o(this,void 0,void 0,(function*(){let t;const e=window.location.search.match(/id=(\d+)/);t=new i;try{if(!e)throw new Error("Can't find crossword ID");const i=e[1],o=yield fetch(`/crosswords/${i}.json`);if(!o.ok)throw new Error("Can't retrieve crossword");const n=yield o.json();t.showCrossword(n)}catch(e){const i=yield fetch("/crosswords/index.json"),o=yield i.json();t.showIndex(o)}}))}()}))}))}},t=>{var e;e=985,t(t.s=e)}]);