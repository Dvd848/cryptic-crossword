"use strict";(self.webpackChunkcryptic_crossword=self.webpackChunkcryptic_crossword||[]).push([[143],{985:()=>{var t;!function(t){t[t.Horizontal=1]="Horizontal",t[t.Vertical=2]="Vertical"}(t||(t={}));class e{constructor(t,e,i){this.LOCAL_STORAGE_VCN_KEY="VCN",this.LOCAL_STORAGE_VCN_VAL="1",this.LOCAL_STORAGE_KEY_PREFIX="crossword_",this.crossword_id=t,this.rows=e,this.cols=i,this.local_storage_key=this.LOCAL_STORAGE_KEY_PREFIX+t.toString(),this.localStorageInit(),this.user_input=this.loadInput()}localStorageInit(){localStorage.getItem(this.LOCAL_STORAGE_VCN_KEY)!=this.LOCAL_STORAGE_VCN_VAL&&localStorage.clear(),localStorage.setItem(this.LOCAL_STORAGE_VCN_KEY,this.LOCAL_STORAGE_VCN_VAL)}loadInput(){const t=localStorage.getItem(this.local_storage_key);try{if(null==t||""==t)throw new Error("No previous input");const e=JSON.parse(t);if(e.length!=this.rows||e[0].length!=this.cols)throw new Error("Invalid input");return e}catch(t){return Array.from({length:this.rows},(()=>Array.from({length:this.cols},(()=>""))))}}getLetter(t){if(t.row<0||t.row>=this.rows||t.col<0||t.col>=this.cols)throw new Error("Invalid input for getLetter!");return this.user_input[t.row][t.col]}setLetter(t,e){if(t.row<0||t.row>=this.rows||t.col<0||t.col>=this.cols||e.length>1)throw new Error("Invalid input for setLetter!");this.user_input[t.row][t.col]=e,localStorage.setItem(this.local_storage_key,JSON.stringify(this.user_input))}}class i{constructor(){this.clickContext={activeCoordinate:null,previousCoordinate:null,direction:t.Horizontal},this.storageContext=null,this.TILE_DIMENSIONS=40,this.crossword=document.getElementById("crossword"),this.clues_horizontal=document.getElementById("clues_horizontal"),this.clues_vertical=document.getElementById("clues_vertical"),this.addKeyListener()}showCrossword(t){var i;document.getElementById("title").textContent=`תשבץ אינטל ${t.id}`,document.getElementById("author").textContent=`${t.author}`,this.crossword.innerHTML="",this.clues_horizontal.innerHTML="<h3>מאוזן</h3>",this.clues_vertical.innerHTML="<h3>מאונך</h3>",this.storageContext=new e(t.id,t.dimensions.rows,t.dimensions.columns),this.crossword.appendChild(this.createPuzzleSvg(t)),this.crossword.appendChild(this.createDummyInputGrid(t.dimensions.rows,t.dimensions.columns)),this.clues_horizontal.appendChild(this.createClues("across",t)),this.clues_vertical.appendChild(this.createClues("down",t)),document.getElementById("wrapper").classList.remove("hide"),null===(i=document.getElementById("loader"))||void 0===i||i.remove()}createClues(t,e){const i=document.createElement("dl");for(const o in e.definitions[t]){const n=document.createElement("dt");n.textContent=`[${o}]`;const r=document.createElement("dd");r.textContent=`${e.definitions[t][o]}`,i.appendChild(n),i.appendChild(r)}return i}createDummyInputGrid(t,e){const i=document.createElement("div");for(let o=0;o<t;o++){const t=document.createElement("div");t.className="grid-row";for(let i=0;i<e;i++){const e=document.createElement("input");e.type="text",e.className="dummy_input",e.id=`dummy_input_r${o}_c${i}`,t.insertBefore(e,t.firstChild)}i.appendChild(t)}return i}createPuzzleSvg(t){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width",""+this.TILE_DIMENSIONS*t.dimensions.columns),e.setAttribute("height",""+this.TILE_DIMENSIONS*t.dimensions.rows),this.grid=new Array(t.dimensions.rows);for(let i=0;i<t.dimensions.rows;++i){this.grid[i]=[];for(let o=0;o<t.dimensions.columns;++o){let n=null;const r=document.createElementNS("http://www.w3.org/2000/svg","g"),s=document.createElementNS("http://www.w3.org/2000/svg","rect");if(s.setAttribute("x",""+this.TILE_DIMENSIONS*o),s.setAttribute("y",""+this.TILE_DIMENSIONS*i),s.setAttribute("width",`${this.TILE_DIMENSIONS}`),s.setAttribute("height",`${this.TILE_DIMENSIONS}`),s.setAttribute("stroke","black"),s.setAttribute("stroke-width","1"),s.setAttribute("fill","white"),r.appendChild(s),"#"==t.grid[i][o])s.setAttribute("fill","black");else{if(""!=t.grid[i][o]){const e=document.createElementNS("http://www.w3.org/2000/svg","text");e.setAttribute("x",""+(o*this.TILE_DIMENSIONS+this.TILE_DIMENSIONS-4)),e.setAttribute("y",""+(i*this.TILE_DIMENSIONS+12)),e.setAttribute("style","fill: black; font-size: 10px;"),e.textContent=t.grid[i][o],r.appendChild(e)}const e=document.createElementNS("http://www.w3.org/2000/svg","text");e.setAttribute("x",""+(o*this.TILE_DIMENSIONS+this.TILE_DIMENSIONS/2)),e.setAttribute("y",""+(i*this.TILE_DIMENSIONS+(this.TILE_DIMENSIONS-this.TILE_DIMENSIONS/4))),e.setAttribute("text-anchor","middle"),e.setAttribute("style","fill: black; font-size: 30px;"),r.appendChild(e),n={rect:s,text:e},e.addEventListener("click",(function(){l.handleRectClick(i,o)})),e.textContent=this.storageContext.getLetter({row:i,col:o})}e.appendChild(r),this.grid[i][o]=n;const l=this;s.addEventListener("click",(function(){l.handleRectClick(i,o)}))}}return e}swapDirection(){this.clickContext.direction=this.clickContext.direction==t.Horizontal?t.Vertical:t.Horizontal}isCoordFree(t){return!(t.row<0||t.row>=this.grid.length||t.col<0||t.col>=this.grid[0].length)&&null!=this.grid[t.row][t.col]}nextCoordinate(e){const i={row:e.row,col:e.col};return this.clickContext.direction==t.Horizontal?i.col-=1:i.row+=1,this.isCoordFree(i)?i:null}prevCoordinate(e){const i={row:e.row,col:e.col};return this.clickContext.direction==t.Horizontal?i.col+=1:i.row-=1,this.isCoordFree(i)?i:null}highlightDefinition(t){var e;let i=null,o=null;if(document.querySelectorAll("rect.highlighted").forEach((t=>{t.classList.remove("highlighted"),t.setAttribute("fill","white")})),null!=t){null==this.prevCoordinate(t)&&null==this.nextCoordinate(t)&&this.swapDirection();for(const e of[this.prevCoordinate,this.nextCoordinate]){i={row:t.row,col:t.col};do{o=this.grid[i.row][i.col],null==o||o.rect.setAttribute("fill","#ccffff"),null==o||o.rect.setAttribute("class","highlighted"),i=e.call(this,i)}while(null!=i)}o=this.grid[t.row][t.col],null==o||o.rect.setAttribute("fill","#ffffcc"),null==o||o.rect.setAttribute("class","highlighted"),null===(e=document.getElementById(`dummy_input_r${t.row}_c${t.col}`))||void 0===e||e.focus()}}handleRectClick(t,e){null!=this.grid[t][e]&&(this.clickContext.previousCoordinate=this.clickContext.activeCoordinate,this.clickContext.activeCoordinate={row:t,col:e},JSON.stringify(this.clickContext.previousCoordinate)==JSON.stringify(this.clickContext.activeCoordinate)&&this.swapDirection(),this.highlightDefinition({row:t,col:e}))}addKeyListener(){const t=this,e=function(e){var i,o,n;let r=e.key;if("Unidentified"==r&&(r=e.target.value),e.target.value="",null==t.clickContext.activeCoordinate)return;const s=t.grid[t.clickContext.activeCoordinate.row][t.clickContext.activeCoordinate.col];null!=s&&(1===r.length&&/^[a-zA-Z\u0590-\u05FF]$/.test(r)?(s.text.textContent=r,null===(i=t.storageContext)||void 0===i||i.setLetter(t.clickContext.activeCoordinate,s.text.textContent),t.clickContext.activeCoordinate=t.nextCoordinate(t.clickContext.activeCoordinate),t.highlightDefinition(t.clickContext.activeCoordinate)):"Backspace"===r?(s.text.textContent="",null===(o=t.storageContext)||void 0===o||o.setLetter(t.clickContext.activeCoordinate,s.text.textContent),t.clickContext.activeCoordinate=t.prevCoordinate(t.clickContext.activeCoordinate),t.highlightDefinition(t.clickContext.activeCoordinate)):"Delete"==r&&(s.text.textContent="",null===(n=t.storageContext)||void 0===n||n.setLetter(t.clickContext.activeCoordinate,s.text.textContent)),e.stopImmediatePropagation())};document.body.addEventListener("keyup",e),Array.from(document.getElementsByClassName("dummy_input")).forEach(((t,i,o)=>{t.addEventListener("keyup",e)}))}showIndex(t){var e;const i=document.getElementById("crossword_list");for(let e of t.ids){let t=document.createElement("li"),o=document.createElement("a");o.textContent=`תשבץ ${e}`,o.setAttribute("href",`?id=${e}`),t.appendChild(o),i.appendChild(t)}document.getElementById("index").classList.remove("hide"),null===(e=document.getElementById("loader"))||void 0===e||e.remove()}}var o=function(t,e,i,o){return new(i||(i=Promise))((function(n,r){function s(t){try{c(o.next(t))}catch(t){r(t)}}function l(t){try{c(o.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,l)}c((o=o.apply(t,e||[])).next())}))};document.addEventListener("DOMContentLoaded",(function(){return o(this,void 0,void 0,(function*(){yield function(){return o(this,void 0,void 0,(function*(){let t;const e=window.location.search.match(/id=(\d+)/);t=new i;try{if(!e)throw new Error("Can't find crossword ID");const i=e[1],o=yield fetch(`crosswords/${i}.json`);if(!o.ok)throw new Error("Can't retrieve crossword");const n=yield o.json();t.showCrossword(n)}catch(e){const i=yield fetch("index.json"),o=yield i.json();t.showIndex(o)}}))}()}))}))}},t=>{var e;e=985,t(t.s=e)}]);