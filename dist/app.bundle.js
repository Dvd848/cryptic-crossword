"use strict";(self.webpackChunkcryptic_crossword=self.webpackChunkcryptic_crossword||[]).push([[143],{985:()=>{var t;!function(t){t[t.Horizontal=1]="Horizontal",t[t.Vertical=2]="Vertical"}(t||(t={}));class e{constructor(t,e,o){this.LOCAL_STORAGE_VCN_KEY="VCN",this.LOCAL_STORAGE_VCN_VAL="1",this.LOCAL_STORAGE_KEY_PREFIX="crossword_",this.crossword_id=t,this.rows=e,this.cols=o,this.local_storage_key=this.LOCAL_STORAGE_KEY_PREFIX+t.toString(),this.localStorageInit(),this.user_input=this.loadInput()}localStorageInit(){localStorage.getItem(this.LOCAL_STORAGE_VCN_KEY)!=this.LOCAL_STORAGE_VCN_VAL&&localStorage.clear(),localStorage.setItem(this.LOCAL_STORAGE_VCN_KEY,this.LOCAL_STORAGE_VCN_VAL)}loadInput(){const t=localStorage.getItem(this.local_storage_key);try{if(null==t||""==t)throw new Error("No previous input");const e=JSON.parse(t);if(e.length!=this.rows||e[0].length!=this.cols)throw new Error("Invalid input");return e}catch(t){return Array.from({length:this.rows},(()=>Array.from({length:this.cols},(()=>""))))}}getLetter(t){if(t.row<0||t.row>=this.rows||t.col<0||t.col>=this.cols)throw new Error("Invalid input for getLetter!");return this.user_input[t.row][t.col]}setLetter(t,e){if(t.row<0||t.row>=this.rows||t.col<0||t.col>=this.cols||e.length>1)throw new Error("Invalid input for setLetter!");this.user_input[t.row][t.col]=e,localStorage.setItem(this.local_storage_key,JSON.stringify(this.user_input))}}class o{constructor(){this.clickContext={activeCoordinate:null,previousCoordinate:null,direction:t.Horizontal},this.storageContext=null,this.TILE_DIMENSIONS=40,this.crossword=document.getElementById("crossword"),this.clues_horizontal=document.getElementById("clues_horizontal"),this.clues_vertical=document.getElementById("clues_vertical"),this.addKeyListener()}showCrossword(t){var o;document.getElementById("title").textContent=`תשבץ אינטל ${t.id}`,document.getElementById("author").textContent=`${t.author}`,this.crossword.innerHTML="",this.clues_horizontal.innerHTML="<h3>מאוזן</h3>",this.clues_vertical.innerHTML="<h3>מאונך</h3>",this.storageContext=new e(t.id,t.dimensions.rows,t.dimensions.columns),this.crossword.appendChild(this.createPuzzleSvg(t)),this.crossword.appendChild(this.createDummyInputGrid(t.dimensions.rows,t.dimensions.columns)),this.clues_horizontal.appendChild(this.createClues("across",t)),this.clues_vertical.appendChild(this.createClues("down",t)),document.getElementById("wrapper").classList.remove("hide"),null===(o=document.getElementById("loader"))||void 0===o||o.remove()}createClues(t,e){const o=document.createElement("dl");for(const i in e.definitions[t]){const n=document.createElement("dt");n.textContent=`[${i}]`;const r=document.createElement("dd");r.textContent=`${e.definitions[t][i]}`,o.appendChild(n),o.appendChild(r)}return o}createDummyInputGrid(t,e){const o=document.createElement("div");for(let i=0;i<t;i++){const t=document.createElement("div");t.className="grid-row";for(let o=0;o<e;o++){const e=document.createElement("input");e.type="text",e.className="dummy_input",e.id=`dummy_input_r${i}_c${o}`,t.insertBefore(e,t.firstChild)}o.appendChild(t)}return o}createPuzzleSvg(t){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width",""+this.TILE_DIMENSIONS*t.dimensions.columns),e.setAttribute("height",""+this.TILE_DIMENSIONS*t.dimensions.rows),this.grid=new Array(t.dimensions.rows);for(let o=0;o<t.dimensions.rows;++o){this.grid[o]=[];for(let i=0;i<t.dimensions.columns;++i){let n=null;const r=document.createElementNS("http://www.w3.org/2000/svg","g"),s=document.createElementNS("http://www.w3.org/2000/svg","rect");if(s.setAttribute("x",""+this.TILE_DIMENSIONS*i),s.setAttribute("y",""+this.TILE_DIMENSIONS*o),s.setAttribute("width",`${this.TILE_DIMENSIONS}`),s.setAttribute("height",`${this.TILE_DIMENSIONS}`),s.setAttribute("stroke","black"),s.setAttribute("stroke-width","1"),s.setAttribute("fill","white"),r.appendChild(s),"#"==t.grid[o][i])s.setAttribute("fill","black");else{if(""!=t.grid[o][i]){const e=document.createElementNS("http://www.w3.org/2000/svg","text");e.setAttribute("x",""+(i*this.TILE_DIMENSIONS+this.TILE_DIMENSIONS-4)),e.setAttribute("y",""+(o*this.TILE_DIMENSIONS+12)),e.setAttribute("style","fill: black; font-size: 10px;"),e.textContent=t.grid[o][i],r.appendChild(e)}const e=document.createElementNS("http://www.w3.org/2000/svg","text");e.setAttribute("x",""+(i*this.TILE_DIMENSIONS+this.TILE_DIMENSIONS/2)),e.setAttribute("y",""+(o*this.TILE_DIMENSIONS+(this.TILE_DIMENSIONS-this.TILE_DIMENSIONS/4))),e.setAttribute("text-anchor","middle"),e.setAttribute("style","fill: black; font-size: 30px;"),r.appendChild(e),n={rect:s,text:e},e.addEventListener("click",(function(){c.handleRectClick(o,i)})),e.textContent=this.storageContext.getLetter({row:o,col:i})}e.appendChild(r),this.grid[o][i]=n;const c=this;s.addEventListener("click",(function(){c.handleRectClick(o,i)}))}}return e}swapDirection(){this.clickContext.direction=this.clickContext.direction==t.Horizontal?t.Vertical:t.Horizontal}isCoordFree(t){return!(t.row<0||t.row>=this.grid.length||t.col<0||t.col>=this.grid[0].length)&&null!=this.grid[t.row][t.col]}nextCoordinate(e){const o={row:e.row,col:e.col};return this.clickContext.direction==t.Horizontal?o.col-=1:o.row+=1,this.isCoordFree(o)?o:null}prevCoordinate(e){const o={row:e.row,col:e.col};return this.clickContext.direction==t.Horizontal?o.col+=1:o.row-=1,this.isCoordFree(o)?o:null}highlightDefinition(t){var e;let o=null,i=null;if(document.querySelectorAll("rect.highlighted").forEach((t=>{t.classList.remove("highlighted"),t.setAttribute("fill","white")})),null!=t){null==this.prevCoordinate(t)&&null==this.nextCoordinate(t)&&this.swapDirection();for(const e of[this.prevCoordinate,this.nextCoordinate]){o={row:t.row,col:t.col};do{i=this.grid[o.row][o.col],null==i||i.rect.setAttribute("fill","#ccffff"),null==i||i.rect.setAttribute("class","highlighted"),o=e.call(this,o)}while(null!=o)}i=this.grid[t.row][t.col],null==i||i.rect.setAttribute("fill","#ffffcc"),null==i||i.rect.setAttribute("class","highlighted"),null===(e=document.getElementById(`dummy_input_r${t.row}_c${t.col}`))||void 0===e||e.focus()}}handleRectClick(t,e){null!=this.grid[t][e]&&(this.clickContext.previousCoordinate=this.clickContext.activeCoordinate,this.clickContext.activeCoordinate={row:t,col:e},JSON.stringify(this.clickContext.previousCoordinate)==JSON.stringify(this.clickContext.activeCoordinate)&&this.swapDirection(),this.highlightDefinition({row:t,col:e}))}addKeyListener(){const t=this,e=function(e){var o,i,n;let r=e.key;if("Unidentified"==r&&(r=e.target.value),e.target.value="",null==t.clickContext.activeCoordinate)return;const s=t.grid[t.clickContext.activeCoordinate.row][t.clickContext.activeCoordinate.col];null!=s&&(1===r.length&&/^[a-zA-Z\u0590-\u05FF]$/.test(r)?(s.text.textContent=r,null===(o=t.storageContext)||void 0===o||o.setLetter(t.clickContext.activeCoordinate,s.text.textContent),t.clickContext.activeCoordinate=t.nextCoordinate(t.clickContext.activeCoordinate),t.highlightDefinition(t.clickContext.activeCoordinate)):"Backspace"===r?(s.text.textContent="",null===(i=t.storageContext)||void 0===i||i.setLetter(t.clickContext.activeCoordinate,s.text.textContent),t.clickContext.activeCoordinate=t.prevCoordinate(t.clickContext.activeCoordinate),t.highlightDefinition(t.clickContext.activeCoordinate)):"Delete"==r&&(s.text.textContent="",null===(n=t.storageContext)||void 0===n||n.setLetter(t.clickContext.activeCoordinate,s.text.textContent)),e.stopImmediatePropagation())};document.body.addEventListener("keyup",e),Array.from(document.getElementsByClassName("dummy_input")).forEach(((t,o,i)=>{t.addEventListener("keyup",e)}))}showIndex(t){var e,o;!function(t){const e=document.getElementById("crosswordSelect");t.forEach((t=>{const o=document.createElement("option");o.value=String(t),o.textContent=`תשבץ #${t}`,e.appendChild(o)}))}(t.ids.slice().sort(((t,e)=>e-t))),null===(e=document.getElementById("chooseCrossword"))||void 0===e||e.addEventListener("click",(function(){const t=document.getElementById("crosswordSelect").value;t&&(window.location.href=`?id=${t}`)})),document.getElementById("index").classList.remove("hide"),null===(o=document.getElementById("loader"))||void 0===o||o.remove()}}var i=function(t,e,o,i){return new(o||(o=Promise))((function(n,r){function s(t){try{l(i.next(t))}catch(t){r(t)}}function c(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(s,c)}l((i=i.apply(t,e||[])).next())}))};document.addEventListener("DOMContentLoaded",(function(){return i(this,void 0,void 0,(function*(){yield function(){return i(this,void 0,void 0,(function*(){let t;const e=window.location.search.match(/id=(\d+)/);t=new o;try{if(!e)throw new Error("Can't find crossword ID");const o=e[1],i=yield fetch(`crosswords/${o}.json`);if(!i.ok)throw new Error("Can't retrieve crossword");const n=yield i.json();t.showCrossword(n)}catch(e){const o=yield fetch("index.json"),i=yield o.json();t.showIndex(i)}}))}()}))}))}},t=>{var e;e=985,t(t.s=e)}]);